# Исследование ISS‑API Московской биржи для дневных свечей LQDT/TQTF

## Цель

Зафиксировать выбранный публичный эндпоинт ISS‑API Мосбиржи для получения дневных свечей (OHLCV) инструмента **LQDT** с доски **TQTF** за период последних 7 календарных дней, а также маппинг полей ответа в целевую модель.

## Выбранный эндпоинт

- Базовый путь: `https://iss.moex.com/iss/`
- Эндпоинт свечей:  
  `engines/stock/markets/shares/boards/TQTF/securities/LQDT/candles.json`
- Параметры запроса:
  - `from` — дата начала периода в формате `YYYY-MM-DD`
  - `till` — дата конца периода в формате `YYYY-MM-DD`
  - `interval=24` — дневные свечи (24 часа)
- Итоговый URL-пример:  
  `https://iss.moex.com/iss/engines/stock/markets/shares/boards/TQTF/securities/LQDT/candles.json?from=2025-11-28&till=2025-12-04&interval=24`

## Формат ответа

Ответ в JSON содержит секцию `candles` с полями `columns` и `data`.

```json
{
  "candles": {
    "columns": [
      "open", "close", "high", "low", "value", "volume", "begin", "end", "boardid"
    ],
    "data": [
      [1125.0, 1130.5, 1135.0, 1120.0, 1500000.0, 1200.0, "2025-11-28 10:00:00", "2025-11-28 18:45:00", "TQTF"],
      ...
    ]
  }
}
```

### Ключевые поля

- `begin` — дата/время начала интервала свечи (используем дату `YYYY-MM-DD` как ключ)
- `open`, `high`, `low`, `close` — цены
- `volume` — объём
- `boardid` — ожидаем `TQTF`
- `value` (денежный оборот) в рамках LQDT/TQTF не используется, сохраняется для контекста

## Маппинг полей ответа → целевые поля XLSX/модели

| Поле ответа | Тип          | Целевое поле | Правило                                                      |
|-------------|--------------|--------------|--------------------------------------------------------------|
| `begin`     | string (dt)  | `date`       | Конвертация в дату; используется для идентификации дня       |
| `open`      | number/null  | `open`       | Число ≥ 0 или `None`, допускаются пропуски                   |
| `high`      | number/null  | `high`       | Число ≥ 0 или `None`, допускаются пропуски                   |
| `low`       | number/null  | `low`        | Число ≥ 0 или `None`, допускаются пропуски                   |
| `close`     | number/null  | `close`      | Число ≥ 0 или `None`, допускаются пропуски                   |
| `volume`    | number/null  | `volume`     | Число ≥ 0 или `None`, допускаются пропуски                   |
| `boardid`   | string       | `board`      | Ожидаем `TQTF`, иначе ошибка валидации                       |
| (константа) | —            | `instrument` | Всегда `LQDT` для данной фичи                               |

## Особые случаи и поведение

- Если за день нет торгов (выходной/праздник) или данных нет, API может не вернуть запись на дату; мы должны вернуть запись с `None` в числовых полях.
- Отсутствие ожидаемых колонок (`open`, `high`, `low`, `close`, `volume`, `begin`) считается некорректным ответом API.
- Сетевые ошибки, таймауты или HTTP 4xx/5xx должны классифицироваться и пробрасываться в CLI с человеко-понятными сообщениями на русском языке (см. contracts/cli-contract.md).

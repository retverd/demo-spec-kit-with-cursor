# Research: обязательный ввод длительности интервала (`--days`)

**Date**: 2025-12-11  
**Feature**: `001-require-interval-days`

Все вопросы из технического контекста закрыты; ниже решения с обоснованиями.

## Решения

### 1) Диапазон допустимых значений `--days`

- **Decision**: Принимать только целые числа в диапазоне 1–365 (включительно); валидация выполняется до любых сетевых вызовов.
- **Rationale**: Требования задают предположение 1–365; такой потолок покрывает год истории без избыточных нагрузок на внешние API и остаётся предсказуемым для тестов.
- **Alternatives considered**:
  - Без верхней границы — риск долгих запросов/нагрузки на API и длительных тестов.  
  - Граница 30 дней — не покрывает заявленное предположение и типовые потребности анализа.

### 2) Расчёт периода

- **Decision**: Конечная дата всегда локальная `date.today()`, начало рассчитывается как `today - (days - 1)`, период включителен; даты упорядочены от старой к новой.
- **Rationale**: Соответствует требованиям спецификации и текущей модели данных; сохраняет включение сегодняшнего дня.
- **Alternatives considered**:  
  - UTC-наивный расчёт по часовой зоне API — не нужен, т.к. CLI ориентирован на локальный запуск.  
  - Сдвиг на вчера как конец периода — нарушает явное требование «окончание — сегодняшний день».

### 3) Поведение при отсутствии/невалидном `--days`

- **Decision**: CLI выводит понятное сообщение об обязательности/границах параметра и завершается кодом `EXIT_VALIDATION_ERROR = 5`; внешние вызовы не выполняются.
- **Rationale**: Сохраняет текущую семантику кодов выхода, предотвращает лишние запросы, даёт пользователю однозначную подсказку.
- **Alternatives considered**:  
  - Полагаться на стандартный `argparse` exit code 2 — дублировало бы семантику и усложнило единообразие кодов.  
  - Использовать код API-ошибки (1) — не отражает природу ошибки (ввод пользователя).

### 4) Логирование и метаданные периода

- **Decision**: Логи и пользовательский вывод должны явно содержать `start_date` и `end_date`; файлы Parquet/XLSX включают эти значения в метаданные и имени файла.
- **Rationale**: Требования FR-004/FR-005; упрощает проверку корректности периода в интеграционных и перф-тестах.
- **Alternatives considered**:  
  - Логировать только `days` без дат — ухудшает трассируемость и усложняет диагностику.

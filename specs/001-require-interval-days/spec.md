# Feature Specification: Обязательный ввод длительности интервала в CLI

**Feature Branch**: `[001-require-interval-days]`  
**Created**: 2025-12-10  
**Status**: Draft  
**Input**: User description: "Для команд cbr и moex-lqdt в @src/cli/main.py сделай обязательную передачу длительности интервала времени в днях. Окончание периода - также сегодняшний день."

> **Примечание**: Согласно конституции проекта, все спецификации должны быть написаны на русском языке.
> Добавляйте сценарии для интеграционных тестов с реальной системой (особенно перф-тестов), когда функционал зависит от внешних сервисов.
> Каждый пользовательский сценарий и его тесты должны оставаться независимыми.

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Курс CBR с обязательным числом дней (Priority: P1)

Пользователь запускает команду `cbr`, обязан указать длительность в днях и получает файл с курсами за рассчитанный период, заканчивающийся сегодняшним днем.

**Why this priority**: Это базовый сценарий использования CLI для курсов валют; без него функциональность теряет ценность.

**Independent Test**: Запуск `cbr` с валидным числом дней (например, 5) создает файл курсов за последние 5 дней, включая сегодня, без зависимостей от других историй.

**Acceptance Scenarios**:

1. **Given** пользователь в рабочей директории, **When** запускает CLI `cbr --days 5`, **Then** создается Parquet с записями за 5 дней и вывод содержит корректный интервал.
2. **Given** пользователь указал `--days 1`, **When** выполняет команду, **Then** файл содержит только данные за сегодняшний день.

---

### User Story 2 - Свечи MOEX с обязательным числом дней (Priority: P2)

Пользователь запускает команду `moex-lqdt`, указывает длительность в днях и получает XLSX со свечами за период до сегодняшнего дня.

**Why this priority**: Второй основной сценарий CLI; важен для данных MOEX, но зависит от меньшего количества пользователей, чем курсы CBR.

**Independent Test**: Запуск `moex-lqdt --days 7` возвращает XLSX со свечами за 7 дней до сегодняшнего, тестируется отдельно от CBR.

**Acceptance Scenarios**:

1. **Given** указан параметр `--days 7`, **When** выполняется `moex-lqdt`, **Then** создается XLSX с данными за 7 дней, включая текущую дату.
2. **Given** пользователь меняет значение на `--days 3`, **When** запускает команду, **Then** период сдвигается и лог отражает новые даты.

---

### User Story 3 - Ошибки неверной длительности (Priority: P3)

Пользователь вводит некорректную длительность (отсутствует, ноль, отрицательное число или нецелое значение) и получает понятное сообщение об ошибке с ненулевым кодом выхода.

**Why this priority**: Защищает от некорректных данных, уменьшает ложные результаты и упрощает отладку.

**Independent Test**: Запуск CLI с неверными значениями или без параметра завершается с сообщением о проблеме и без создания файлов.

**Acceptance Scenarios**:

1. **Given** запуск `cbr` без `--days`, **When** выполняется команда, **Then** CLI сообщает об обязательном параметре и завершает работу с ошибкой.
2. **Given** запуск `moex-lqdt --days -5`, **When** выполняется команда, **Then** выводит сообщение о недопустимом значении и не создает файл.

### Edge Cases

- `--days 1`: период состоит только из текущей даты.
- Верхняя граница допустимой длительности (предположение: 30 дней) — проверяется корректность периода и сообщения об ошибке при превышении.
- Некорректный ввод: нецелое, текст, ноль, отрицательное число — CLI возвращает ошибку без создания файлов.
- Выполнение в дату смены месяца/года или на високосный год — конец периода остается сегодняшним днем.

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: CLI команды `cbr` и `moex-lqdt` принимают обязательный параметр длительности в днях; отсутствие параметра приводит к понятной ошибке и ненулевому завершению.
- **FR-002**: При валидном `days` стартовый день рассчитывается как (сегодня – (days - 1)), конечный день всегда сегодняшний (по локальной дате запуска).
- **FR-003**: Значение `days` должно быть целым числом в допустимом диапазоне (предположение: 1–30); выход за пределы или неверный тип вызывает ошибку валидации без обращения к внешним сервисам.
- **FR-004**: Сообщения логов и пользовательский вывод отражают выбранный интервал (старт/конец) для обеих команд.
- **FR-005**: Создаваемые файлы (Parquet/XLSX) и метаданные содержат фактический период, соответствующий переданному `days`.
- **FR-006**: Текущие бизнес-потоки (получение курсов и свечей, формат выходных файлов) сохраняются без регрессий, меняется только способ задания периода.

### Key Entities *(include if feature involves data)*

- **Параметр длительности (`days`)**: обязательное целое значение, определяющее длину интервала; проверяется на диапазон.
- **Интервал дат**: вычисляется из `days` и текущей даты; используется для запросов к внешним сервисам и для метаданных файлов.
- **Выходные артефакты**: Parquet для `cbr` и XLSX для `moex-lqdt`, содержат данные за рассчитанный период и отражают даты в метаданных/именах.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Запуск `cbr` с валидным `--days` (1–30) завершается успешно и создает файл с корректным интервалом, включающим текущую дату, в 100% тестовых прогонов.
- **SC-002**: Запуск `moex-lqdt` с валидным `--days` (1–30) создает XLSX с корректным интервалом, включающим текущую дату, в 100% тестовых прогонов.
- **SC-003**: Запуски без `--days` или с недопустимым значением завершаются с ошибкой до обращения к внешним сервисам, с читаемым сообщением, в 100% тестовых прогонов.
- **SC-004**: Для выборки контрольных значений `days` (1, 7, 30) вычисленные даты в логах и метаданных совпадают с ожидаемыми в 100% проверок.
